language: python

python:
  - '2.7'
  - '3.4'
  - '3.5'
  - '3.6'

install:

  - python setup.py install

script:

  - make test args='--verbose'

deploy:
  # create tag
  - git config --global user.email "ci@smartcar.com"
  - git config --global user.name "Travis CI User"
  - export tag=$(cat SmartcarAuth.podspec | grep '^\s*s.version' | sed "s/[[:blank:]]*s.version[[:blank:]]*=[[:blank:]]*'\(.*\)'/\1/g")
  - if [ "$TRAVIS_BRANCH" = "master" ]; then git tag -a v$spec -m "Travis Generated Tag"; fi

deploy:

  - provider: script
    skip_cleanup: true
    script: echo -e "machine github.com\n  login $CI_USER_TOKEN" >> ~/.netrc && git push origin v$tag
    on:
      branch: master

  - provider: pypi
    user:
    password:
      secure:
    on:
      tags: true
